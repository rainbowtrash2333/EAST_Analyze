# 银行流水分析系统

一个基于Flask的Web应用程序，用于分析银行流水数据并生成可视化报告和资金流向网络图。

## 功能特色

### 流水分析模式
- 📊 **交易对手分析** - 统计各交易对手的交易次数、金额和收支情况
- 📈 **交易类型统计** - 分析不同交易类型的使用频率和金额分布  
- 📅 **时间趋势分析** - 展示每日和每小时的交易趋势
- 🔍 **多维度统计** - 提供整体统计、渠道分析等多角度洞察
- 📋 **Excel报告** - 自动生成详细的Excel分析报告
- 🖼️ **可视化图表** - 生成多种类型的统计图表

### 网络图分析模式
- 🕸️ **资金流向网络图** - 基于多个Excel文件生成交互式网络图
- 🎯 **智能节点限制** - 自动限制节点数不超过150个，确保图表可读性
- 🔴 **资金流向可视化** - 红色表示资金流出，绿色表示资金流入
- 📊 **网络统计分析** - 提供节点数、连接数、核心账户等统计信息
- 🔬 **深度网络分析** - 度中心性、介数中心性、社区检测、聚类系数分析
- 🏘️ **社区发现** - 自动识别资金流动的社区结构
- 💾 **文件下载** - 支持下载完整的HTML网络图文件

## 系统要求

- Python 3.7+
- Flask 2.3+
- pandas, matplotlib, seaborn, pyvis, networkx, python-louvain 等数据分析库

## 安装步骤

1. 克隆或下载项目到本地
2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```
3. 运行Flask应用：
   ```bash
   python app.py
   ```
4. 在浏览器中访问 `http://localhost:5000`

## 使用方法

### 流水分析模式
1. 在主页选择"流水分析"选项
2. 上传单个Excel文件
3. 查看详细的统计结果和可视化图表
4. 下载Excel报告和PNG格式的图表文件

### 网络图分析模式
1. 在主页选择"网络图分析"选项
2. 同时上传多个Excel文件（包含交易数据）
3. 查看交互式的资金流向网络图
4. 下载HTML格式的网络图文件

## 文件格式要求

### 流水分析文件格式
上传的Excel文件需要包含以下列：
- 交易借贷标志
- 交易金额  
- 对方户名
- 对方账号
- 对方行名
- 现转标志
- 交易类型
- 交易渠道
- 核心交易日期
- 核心交易时间

### 网络图分析文件格式
上传的Excel文件需要包含以下列：
- 账户名称
- 借贷标志
- 对方户名
- 交易金额

**可选列（用于深度网络分析）：**
- 证件号码（用于更精确的网络节点识别）

**注意**：如果文件包含证件号码列，系统将进行更深入的网络分析，包括度中心性、介数中心性、社区检测等高级分析。

## 项目结构

```
EAST_Analyze/
├── app.py                  # Flask主应用文件
├── analysis.py             # 流水分析模块
├── network_analysis.py     # 网络图分析模块
├── requirements.txt        # 依赖包列表
├── templates/              # HTML模板
│   ├── index.html          # 主页模板
│   ├── results.html        # 流水分析结果页面
│   └── network_results.html # 网络图分析结果页面
├── static/                 # 静态文件
│   ├── charts/             # 生成的图表存储
│   └── networks/           # 生成的网络图存储
├── uploads/                # 上传文件临时存储
├── outputs/                # 生成的报告文件
└── jupyter/                # 原始Jupyter notebook
    ├── 流水分析.ipynb
    └── 画图.ipynb
```

## 技术栈

- **后端**: Flask, pandas, numpy, matplotlib, seaborn, pyvis, networkx
- **前端**: Bootstrap 5, HTML5, JavaScript
- **数据处理**: openpyxl, xlrd
- **可视化**: matplotlib, seaborn, pyvis
- **网络分析**: networkx, python-louvain (社区检测)

## 特殊功能说明

### 网络图节点限制
- 系统自动限制网络图节点数不超过150个
- 当节点数超过限制时，系统会按交易金额排序，保留最重要的150个节点
- 这确保了网络图的可读性和性能

### 深度网络分析
- **度中心性分析**: 识别网络中连接最多的关键节点
- **介数中心性分析**: 发现在信息传播中起关键作用的中介节点
- **社区检测**: 使用Louvain算法自动识别资金流动的社区结构
- **聚类系数**: 衡量网络的局部聚集特性
- **连通分量分析**: 识别网络中相互连接的组件

### 交互式网络图
- 支持节点拖拽移动
- 鼠标悬停显示详细信息
- 动态物理引擎布局
- 缩放和平移功能

## 注意事项

- 流水分析支持的文件格式：.xlsx, .xls（单个文件）
- 网络图分析支持的文件格式：.xlsx, .xls（多个文件）
- 最大文件大小：16MB
- 分析完成后会自动清理临时文件
- 生成的报告和图表会保存在outputs和static目录中

## 故障排除

如果遇到问题，请检查：
1. Python版本是否为3.7+
2. 所有依赖包是否正确安装（特别是pyvis、networkx、python-louvain）
3. 上传的Excel文件格式是否正确
4. 文件是否包含所有必需的列
5. 网络图分析需要上传多个文件
6. 对于深度网络分析，确保文件包含证件号码列

## 更新日志

### v2.1 (最新)
- 新增深度网络分析功能
- 度中心性和介数中心性分析
- 基于Louvain算法的社区检测
- 聚类系数和连通分量分析
- 网络密度计算
- 支持证件号码列的高级网络分析

### v2.0
- 新增网络图分析功能
- 支持多文件上传处理
- 智能节点数量限制（不超过150个）
- 交互式资金流向可视化
- 优化用户界面，支持两种分析模式切换

### v1.0
- 基础流水分析功能
- 统计图表生成
- Excel报告导出